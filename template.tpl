___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Drezzy Pixel",
  "categories": [
    "CONVERSIONS"
  ],
  "brand": {
    "id": "brand_dummy",
    "displayName": "",
    "thumbnail": "data:image/png;base64,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\u003d\u003d"
  },
  "description": "",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "merchantKey",
    "displayName": "Chiave Merchant",
    "simpleValueType": true,
    "help": "Inserire qui la chiave merchant che ti è stata fornita dal referente commerciale Drezzy"
  },
  {
    "type": "GROUP",
    "name": "cartAmountOptions",
    "displayName": "Opzioni Totale Carrello",
    "groupStyle": "NO_ZIPPY",
    "subParams": [
      {
        "type": "CHECKBOX",
        "name": "valueIncludesTax",
        "checkboxText": "Il valore dell\u0027ordine include le tasse",
        "simpleValueType": true,
        "help": "Il campo del dataLayer contenente il totale del carrello, value per GA4 o revenue per UA, include il valore del campo tax",
        "defaultValue": true
      },
      {
        "type": "CHECKBOX",
        "name": "valueIncludesShipping",
        "checkboxText": "Il valore dell\u0027ordine include le spese di spedizione",
        "simpleValueType": true,
        "help": "Il campo del dataLayer contenente il totale del carrello, value per GA4 o revenue per UA, include il valore del campo shipping",
        "defaultValue": true
      }
    ]
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const copyFromDataLayer = require('copyFromDataLayer');
const encodeUriComponent = require('encodeUriComponent');
const logToConsole = require('logToConsole');
const sendPixel = require('sendPixel');

if (!data.hasOwnProperty('merchantKey')) {
  logToConsole('drezzy pixel: chiave merchant non definita');
  data.gtmOnFailure();
  return;
}

const ecommerce = copyFromDataLayer('ecommerce');
if (!ecommerce) {
  logToConsole('drezzy pixel: ecommerce not detected in the dataLayer');
  data.gtmOnFailure();
  return;
}

let tax, shipping, drtp_oid, drtp_oa, drtp_line_items;
if (ecommerce.transaction_id) {
  // GA4
  drtp_oid = ecommerce.transaction_id + '_ga4_gtm'; // remove this suffix after test phase
  drtp_oa = ecommerce.value;
  tax = ecommerce.tax;
  shipping = ecommerce.shipping;
  drtp_line_items = [];
  ecommerce.items.forEach((item) =>
    drtp_line_items.push({ sku: item.item_id, product_name: item.item_name })
  );
} else if (ecommerce.purchase) {
  // UA
  const purchase = ecommerce.purchase;
  drtp_oid = purchase.actionField.id + '_gtm'; // remove this suffix after test phase
  drtp_oa = purchase.actionField.revenue;
  tax = purchase.actionField.tax;
  shipping = purchase.actionField.shipping;
  drtp_line_items = [];
  purchase.products.forEach((product) =>
    drtp_line_items.push({ sku: product.id, product_name: product.name })
  );
} else {
  logToConsole('drezzy pixel: purchase measurement not defined');
  data.gtmOnFailure();
  return;
}

// Compute order amount
if (!data.valueIncludesTax) {
    drtp_oa += tax;
}
if (!data.valueIncludesShipping) {
    drtp_oa += shipping;
}

const drtp_mk = data.merchantKey.trim();

const drtp_pixel =
  'https://www.drezzy.it/api/orders/v1.0/tr.png?' +
  'merchant_name=' +
  encodeUriComponent(drtp_mk) +
  '&order_id=' +
  encodeUriComponent(drtp_oid) +
  jsonToQueryString(drtp_line_items, 'items') +
  '&amount=' +
  encodeUriComponent(drtp_oa);
// logToConsole(drtp_pixel); // enable for debugging tests
sendPixel(drtp_pixel, data.gtmOnSuccess, data.gtmOnFailure);

function jsonToQueryString(obj, prefix) {
  var str = [],
    p;
  for (p in obj) {
    if (obj.hasOwnProperty(p)) {
      var k = prefix ? prefix + '[' + p + ']' : p,
        v = obj[p];
      str.push(
        v !== null && typeof v === 'object' ? jsonToQueryString(v, k) : '&' + k + '=' + encodeUriComponent(v)
      );
    }
  }
  return str.join('');
}


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "send_pixel",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedUrls",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://www.drezzy.it/api/orders/v1.0/tr.png*"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "read_data_layer",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keyPatterns",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "ecommerce.*"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "all"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios:
- name: '[GA3] Order with one item'
  code: |-
    mock('copyFromDataLayer', (key) => {
      if (key === 'ecommerce') {
        return {
          purchase: {
            actionField: {
              id: 'order1234',
              revenue: 100.0,
            },
            products: [
              {
                name: 'product name',
                id: 'sku123',
              },
            ],
          }
        };
      }
    });

    const mockData = {
      merchantKey: 'merchantkey123',
      valueIncludesTax: true,
      valueIncludesShipping: true,
    };

    runCode(mockData);

    assertApi('sendPixel').wasCalledWith('https://www.drezzy.it/api/orders/v1.0/tr.png?merchant_name=merchantkey123&order_id=order1234_gtm&items[0][sku]=sku123&items[0][product_name]=product%20name&amount=100', success, failure);
- name: '[GA3] Order with multiple items'
  code: |-
    mock('copyFromDataLayer', (key) => {
      if (key === 'ecommerce') {
        return {
          purchase: {
            actionField: {
              id: 'order1234',
              revenue: 100.0,
            },
            products: [
              {
                name: 'product name',
                id: 'sku123',
              },
              {
                name: 'product name 2',
                id: 'sku321',
              },
            ],
          }
        };
      }
    });

    const mockData = {
      merchantKey: 'merchantkey123',
      valueIncludesTax: true,
      valueIncludesShipping: true,
    };

    runCode(mockData);

    assertApi('sendPixel').wasCalledWith('https://www.drezzy.it/api/orders/v1.0/tr.png?merchant_name=merchantkey123&order_id=order1234_gtm&items[0][sku]=sku123&items[0][product_name]=product%20name&items[1][sku]=sku321&items[1][product_name]=product%20name%202&amount=100', success, failure);
- name: '[GA4] Order with one item'
  code: |-
    mock('copyFromDataLayer', (key) => {
      if (key === 'ecommerce') {
        return {
          transaction_id: 'order1234',
          value: 100.0,
          items: [
            {
              item_name: 'product name',
              item_id: 'sku123',
            },
          ],
        };
      }
    });

    const mockData = {
      merchantKey: 'merchantkey123',
      valueIncludesTax: true,
      valueIncludesShipping: true,
    };

    runCode(mockData);

    assertApi('sendPixel').wasCalledWith('https://www.drezzy.it/api/orders/v1.0/tr.png?merchant_name=merchantkey123&order_id=order1234_ga4_gtm&items[0][sku]=sku123&items[0][product_name]=product%20name&amount=100', success, failure);
- name: '[GA4] Order with multiple items'
  code: |-
    mock('copyFromDataLayer', (key) => {
      if (key === 'ecommerce') {
        return {
          transaction_id: 'order1234',
          value: 100.0,
          items: [
            {
              item_name: 'product name',
              item_id: 'sku123',
            },
            {
              item_name: 'product name 2',
              item_id: 'sku321',
            },
          ],
        };
      }
    });

    const mockData = {
      merchantKey: 'merchantkey123',
      valueIncludesTax: true,
      valueIncludesShipping: true,
    };

    runCode(mockData);

    assertApi('sendPixel').wasCalledWith('https://www.drezzy.it/api/orders/v1.0/tr.png?merchant_name=merchantkey123&order_id=order1234_ga4_gtm&items[0][sku]=sku123&items[0][product_name]=product%20name&items[1][sku]=sku321&items[1][product_name]=product%20name%202&amount=100', success, failure);
- name: '[GA4] Order with one item (tax excluded)'
  code: |-
    mock('copyFromDataLayer', (key) => {
      if (key === 'ecommerce') {
        return {
          transaction_id: 'order1234',
          value: 100.0,
          tax: 10,
          shipping: 5,
          items: [
            {
              item_name: 'product name',
              item_id: 'sku123',
            },
          ],
        };
      }
    });

    const mockData = {
      merchantKey: 'merchantkey123',
      valueIncludesTax: false,
      valueIncludesShipping: true,
    };

    runCode(mockData);

    assertApi('sendPixel').wasCalledWith('https://www.drezzy.it/api/orders/v1.0/tr.png?merchant_name=merchantkey123&order_id=order1234_ga4_gtm&items[0][sku]=sku123&items[0][product_name]=product%20name&amount=110', success, failure);
- name: '[GA4] Order with one item (shipping excluded)'
  code: |-
    mock('copyFromDataLayer', (key) => {
      if (key === 'ecommerce') {
        return {
          transaction_id: 'order1234',
          value: 100.0,
          tax: 10,
          shipping: 5,
          items: [
            {
              item_name: 'product name',
              item_id: 'sku123',
            },
          ],
        };
      }
    });

    const mockData = {
      merchantKey: 'merchantkey123',
      valueIncludesTax: true,
      valueIncludesShipping: false,
    };

    runCode(mockData);

    assertApi('sendPixel').wasCalledWith('https://www.drezzy.it/api/orders/v1.0/tr.png?merchant_name=merchantkey123&order_id=order1234_ga4_gtm&items[0][sku]=sku123&items[0][product_name]=product%20name&amount=105', success, failure);
- name: Fail if merchant key not defined
  code: |
    mock('copyFromDataLayer', (key) => {
      if (key === 'ecommerce.purchase') {
        return {
          actionField: {
            id: 'order1234',
            revenue: 100.0,
          },
          products: [
            {
              name: 'product name',
              id: 'sku123',
            },
          ],
        };
      }
    });

    const mockData = {}; // merchant key object property missing if not defined in ui

    runCode(mockData);

    assertApi('logToConsole').wasCalledWith("drezzy pixel: chiave merchant non definita");
    assertApi('gtmOnFailure').wasCalled();
- name: Fail if enhanced ecommerce purchase not defined
  code: |
    mock('copyFromDataLayer', (key) => {
      if (key === 'ecommerce') {
        return undefined;
      }
    });

    const mockData = {
      merchantKey: 'merchantkey123',
    };

    runCode(mockData);

    assertApi('logToConsole').wasCalledWith("drezzy pixel: ecommerce not detected in the dataLayer");
    assertApi('gtmOnFailure').wasCalled();
- name: Fail if purchase not defined
  code: |
    mock('copyFromDataLayer', (key) => {
      if (key === 'ecommerce') {
        return {};
      }
    });

    const mockData = {
      merchantKey: 'merchantkey123',
    };

    runCode(mockData);

    assertApi('logToConsole').wasCalledWith("drezzy pixel: purchase measurement not defined");
    assertApi('gtmOnFailure').wasCalled();
setup: |-
  // Workaround needed to use the sendPixel wasCalledWith assertion
  var success, failure;

  mock('sendPixel', (url, onSuccess, onFailure) => {
    success = onSuccess;
    failure = onFailure;
  });


___NOTES___

Created on 8/12/2022, 10:23:03 AM


